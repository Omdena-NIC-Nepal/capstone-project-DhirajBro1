import streamlit as st
import geopandas as gpd
from utils.processor import preprocess_climate_data
from utils.plots import plot_climate_vulnerability_map

st.set_page_config(layout="wide", page_title="Climate Vulnerability Map")

st.title("üìç Climate Vulnerability Map of Nepal")
st.markdown("This map visualizes the relative climate vulnerability of districts based on daily temperature, precipitation, and wind data.")

# Load and process data
processed_df = preprocess_climate_data("data/processed_data/dailyclimate.csv")

# Load district boundaries
districts_gdf = gpd.read_file("data/processed_data/flood_data.geojson")

# Merge on district
districts_gdf["DNM"] = districts_gdf["DNM"].str.strip().str.lower()
processed_df["District"] = processed_df["District"].str.strip().str.lower()

merged_gdf = districts_gdf.merge(processed_df, left_on="DNM", right_on="District")

# Plot
plot_climate_vulnerability_map(merged_gdf, column='vulnerability_index', title="Climate Vulnerability Index")
